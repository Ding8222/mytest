syntax = "proto3";
package netData;

// 2-1 握手
message HandShake
{
	bytes sClientKey = 1;		//base64encode(randomkey)
}

// 2-2 握手返回
message HandShakeRet
{
	bytes sChallenge = 1;		//base64encode(randomkey)
	bytes sServerKey = 2;		//base64encode(dhexchange(randomkey))
}

// 收到1-2之后
// 使用 nServerKey 和 nClientKey 计算出 secret
// 使用 secret 加密 nChallenge
// secret = dhsecret(nClientKey,nServerKey)

// 2-3 挑战握手
message Challenge
{
	string sHmac = 1;		//base64encode(hmac64(nChallenge,secret))
}

// 2-4 挑战握手返回
message ChallengeRet
{
	enum EC
	{
		EC_OTHER = 0;
		EC_SUCC = 1;
		EC_FAIL = 2;
	};
	int32 nCode = 1;	//握手结果
}

// 2-5 认证(账号密码)
message Auth
{
	//token:base64encode(账号)@base64encode(要登陆的服务器ID)@base64encode(密码)
	string sEtoken = 1;	//base64encode(desencode(secret,token))
}

// 2-6 认证返回
message AuthRet
{
	enum EC
	{
		EC_OTHER = 0;
		EC_SUCC = 1;
		EC_FAIL = 2;
	};
	int32 nCode = 1;
}

// 2-7 登陆
message Login
{
	// handshake = base64encode(token.user)@base64encode(token.server)#base64encode(subid):index)
	// hmac = hmac64(hashkey(handshake), secret)
	string sHandShakeKey = 1;	// handshake:base64encode(hmac)
}